{
  "enabled": true,
  "name": "finalize",
  "description": "Consolidates session snapshots and creates a changeset using a two-phase workflow: analyze phase creates changeset template, commit phase verifies and commits after AI updates it",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Consolidate session snapshots and create a changeset using two-phase workflow:\n\n**Phase 1: Analysis**\n1. Execute: `bun run finalize:analyze`\n2. Script will:\n   - Load all session snapshots from `.changeset/snapshots/`\n   - Get git diff from main branch to current branch\n   - Display AI analysis prompt with snapshots and diff\n   - Create changeset file with TODO placeholders\n   - Exit and wait for AI to update changeset\n\n**Phase 2: Your Analysis**\n3. Analyze the displayed data:\n   - Compare snapshots with final commit\n   - Identify what made it to final commit (ignore temporary/experimental changes)\n   - Determine semantic version type (major/minor/patch)\n   - Write user-facing changelog entry\n4. Find the changeset file in `.changeset/` directory\n5. Update the changeset file, replacing ALL TODO placeholders with real content:\n   - Update version type in frontmatter (major/minor/patch)\n   - Replace summary with one-line description\n   - Replace description with 2-3 sentence explanation\n   - Replace all TODO items in Added/Changed/Fixed/Removed sections\n   - Remove empty sections if no items\n\n**Phase 3: Commit**\n6. Execute: `bun run finalize:commit`\n7. Script will:\n   - Verify changeset has no TODOs (fails if TODOs remain)\n   - Clean up snapshot files\n   - Commit the changeset\n   - Auto-squash all commits into one\n   - Display next steps\n\n**Important**: The workflow is fully automated - no user interaction required. You must update the changeset file between phase 1 and phase 2.\n\nThe changeset will be consumed during release to update CHANGELOG.md and bump version."
  }
}